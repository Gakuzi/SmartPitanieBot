# Руководство по развертыванию SmartPit Bot

## Шаг 1: Открытие Google Apps Script

1. Перейдите в [Google Apps Script](https://script.google.com/)
2. Найдите проект "smartPit" в списке ваших проектов
3. Откройте проект

## Шаг 2: Создание нового развертывания

1. В редакторе нажмите кнопку **"Развертывание"** (Deploy)
2. Выберите **"Новое развертывание"** (New deployment)
3. В настройках развертывания:
   - **Тип:** Веб-приложение (Web app)
   - **Выполнять от имени:** Вас (Me)
   - **Кто имеет доступ:** Все (Anyone)
4. Нажмите **"Развернуть"** (Deploy)
5. Скопируйте **URL веб-приложения** (Web app URL)

## Шаг 3: Запуск функции развертывания

1. В редакторе Apps Script откройте файл `0_setup.js`
2. Найдите функцию `deployAndUpdateWebhook()`
3. Нажмите кнопку **"Выполнить"** (Run) рядом с функцией
4. Если появится запрос на разрешения, нажмите **"Продолжить"** (Continue)
5. Предоставьте все необходимые разрешения

## Шаг 4: Проверка статуса

1. Найдите функцию `checkBotStatus()` в файле `0_setup.js`
2. Запустите её для проверки статуса бота
3. Если настроен `ADMIN_CHAT_ID`, вы получите сообщение о статусе в Telegram

## Шаг 5: Тестирование бота

1. Найдите вашего бота в Telegram
2. Отправьте команду `/start`
3. Проверьте, что бот отвечает и показывает меню

## Возможные проблемы и решения

### Проблема: "TELEGRAM_TOKEN не найден"
**Решение:** 
1. Откройте файл `0_setup.js`
2. Найдите функцию `setupTelegramToken()`
3. Запустите её и введите токен вашего бота

### Проблема: "GEMINI_API_KEY не найден"
**Решение:**
1. Откройте файл `0_setup.js`
2. Найдите функцию `setupGeminiApiKey()`
3. Запустите её и введите ключ Gemini API

### Проблема: Бот не отвечает
**Решение:**
1. Запустите `checkBotStatus()` для диагностики
2. Убедитесь, что вебхук установлен правильно
3. Проверьте логи выполнения в Apps Script

### Проблема: Ошибки разрешений
**Решение:**
1. Перейдите в [Настройки разрешений Google](https://myaccount.google.com/permissions)
2. Найдите ваш проект и удалите доступ
3. Запустите любую функцию в Apps Script для повторной авторизации

## Полезные функции для отладки

- `deployAndUpdateWebhook()` - Развертывание и обновление вебхука
- `checkBotStatus()` - Проверка статуса бота
- `setupProjectInfrastructure()` - Настройка инфраструктуры проекта
- `setupTelegramToken()` - Установка токена Telegram
- `setupGeminiApiKey()` - Установка ключа Gemini API

## Структура проекта

```
smartPit/
├── 0_setup.js          # Настройка и развертывание
├── 0_onOpen.js         # Инициализация при открытии
├── 1_main.js           # Основная логика обработки
├── 2_telegram_api.js   # API Telegram
├── 3_ui_menus.js       # Пользовательский интерфейс
├── 4_user_data.js      # Работа с данными пользователей
├── 5_nutrition_ai.js   # AI и расчеты питания
├── 6_sheets_api.js     # API Google Sheets
├── 7_utils.js          # Утилиты
├── 8_gemini_api.js     # API Gemini
├── 9_manual_mode.js    # Ручной режим
├── doPost.js           # Точка входа
└── DEBUG_router.js     # Отладочный маршрутизатор
```

## Контакты для поддержки

Если у вас возникли проблемы, проверьте:
1. Логи выполнения в Google Apps Script
2. Статус вебхука через `checkBotStatus()`
3. Настройки токенов и ключей API 